const t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e={left:"left",right:"right",up:"up",down:"down"},s={start:"start",restart:"restart"},r={idle:"idle",playing:"playing",win:"win",lose:"lose"},o={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"};var i=t=>{let e=document.createElement("td");return e.classList.add(t),e},a=t=>{let e=document.createElement("tr");return e.classList.add(t),e};const h=t=>Math.floor(Math.random()*t),d=t=>t[0].toUpperCase()+t.slice(1),l=()=>1===Math.floor(10*Math.random())+1,n=t=>t.every(t=>t.every(t=>0!==t)),g=t=>t.some(t=>t.some(t=>2048===t));var c=class{constructor(t){this.game=t,this.handleKeyDown=this.handleKeyDown.bind(this),this.setController()}setController(){document.addEventListener("keydown",this.handleKeyDown)}removeController(){document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(t){if(this.game.getStatus()===r.idle)return;let e=JSON.stringify(this.game.getState());switch(this.game.showStatus(),t.key){case o.up:this.game.moveUp();break;case o.down:this.game.moveDown();break;case o.left:this.game.moveLeft();break;case o.right:this.game.moveRight()}JSON.stringify(this.game.getState())!==e&&(this.game.createNewCell(),this.game.updateBoard(this.game.getState()))}},b=class{isMoveLeft(t){for(let e=t.length-1;e>=0;e--)for(let s=t.length-1;s>=0;s--)if(t[e][s-1]===t[e][s])return!0;return!1}isMoveRight(t){for(let e=0;e<t.length;e++)for(let s=0;s<t.length;s++)if(t[e][s]===t[e][s+1])return!0;return!1}isMoveUp(t){for(let e=t.length-1;e>=1;e--)for(let s=t.length-1;s>=0;s--)if(t[e][s]===t[e-1][s])return!0;return!1}isMoveDown(t){for(let e=0;e<t.length-1;e++)for(let s=0;s<t.length;s++)if(t[e][s]===t[e+1][s])return!0;return!1}},m=class{#t=0;#e=[];#s=!1;#r=null;constructor(e=t){this.tbody=document.querySelector("table tbody"),this.htmlScore=document.querySelector(".game-score"),this.messageLose=document.querySelector(".message-lose"),this.messageWin=document.querySelector(".message-win"),this.messageStart=document.querySelector(".message-start"),this.#e=e,this.#t=0,this.#s=!1,this.#r=null}#o(t,e){this.#e[t][e-1]===this.#e[t][e]&&(this.#e[t][e-1]=2*this.#e[t][e-1],this.#e[t][e]=0,this.#t+=this.#e[t][e-1])}#i(t,e){this.#e[t][e]===this.#e[t][e+1]&&(this.#e[t][e+1]=2*this.#e[t][e+1],this.#e[t][e]=0,this.#t+=this.#e[t][e+1])}#a(t,e){this.#e[t][e]===this.#e[t+1][e]&&(this.#e[t+1][e]=2*this.#e[t+1][e],this.#e[t][e]=0,this.#t+=this.#e[t+1][e])}#h(t,e){this.#e[t][e]===this.#e[t-1][e]&&(this.#e[t-1][e]=2*this.#e[t-1][e],this.#e[t][e]=0,this.#t+=this.#e[t-1][e])}#d(t,s,r){r===e.left&&this.#o(t,s),r===e.right&&this.#i(t,s)}#l(t,s,r){r===e.down&&this.#a(t,s),r===e.up&&this.#h(t,s)}moveLeft(){for(let t=this.#e.length-1;t>=0;t--)for(let s=this.#e.length-1;s>=0;s--)0===this.#e[t][s-1]&&(this.#e[t][s-1]=this.#e[t][s],this.#e[t][s]=0),this.#d(t,s,e.left);this.#n(),this.updateBoard(this.#e)}moveRight(){for(let t=0;t<this.#e.length;t++)for(let s=0;s<this.#e.length;s++)0===this.#e[t][s+1]&&(this.#e[t][s+1]=this.#e[t][s],this.#e[t][s]=0),this.#d(t,s,e.right);this.#n(),this.updateBoard(this.#e)}moveUp(){for(let t=this.#e.length-1;t>=1;t--)for(let s=this.#e.length-1;s>=0;s--)0===this.#e[t-1][s]&&(this.#e[t-1][s]=this.#e[t][s],this.#e[t][s]=0),this.#l(t,s,e.up);this.#n(),this.updateBoard(this.#e)}moveDown(){for(let t=0;t<this.#e.length-1;t++)for(let s=0;s<this.#e.length;s++)0===this.#e[t+1][s]&&(this.#e[t+1][s]=this.#e[t][s],this.#e[t][s]=0),this.#l(t,s,e.down);this.#n(),this.updateBoard(this.#e)}#n(){this.htmlScore.textContent=this.#t}#g(){this.#t=0,this.#n()}getState(){return this.#e}getStatus(){let{isMoveLeft:t,isMoveRight:e,isMoveDown:s,isMoveUp:o}=new b;return this.#s?!n(this.#e)||t(this.#e)||e(this.#e)||o(this.#e)||s(this.#e)?g(this.#e)?r.win:r.playing:r.lose:r.idle}showStatus(){let t=this.getStatus();t===r.win&&(this.#s=!1,this.messageWin.classList.remove("hidden")),t===r.lose&&(this.#s=!1,this.messageLose.classList.remove("hidden"))}start(){this.#s=!0,this.messageStart.classList.add("hidden"),this.#r=new c(this),this.createNewCell(),this.createNewCell(),this.updateBoard(this.#e)}createNewCell(){let t=[];for(let e=0;e<this.#e.length;e++)for(let s=0;s<this.#e.length;s++)0===this.#e[e][s]&&t.push({gridPos:e,cellPos:s});let e=h(t.length),{gridPos:s,cellPos:r}=t[e];this.#e[s][r]=l()?4:2}#c(){this.messageLose.classList.add("hidden"),this.messageWin.classList.add("hidden")}restart(){this.#s=!1,this.messageStart.classList.remove("hidden"),this.#g(),this.#c(),this.#r.removeController();for(let t=0;t<this.#e.length;t++)for(let e=0;e<this.#e.length;e++)this.#e[t][e]=0;this.updateBoard(this.#e)}updateBoard(t){this.tbody.innerHTML="";for(let e=0;e<t.length;e++){let s=a("field-row");for(let r=0;r<t.length;r++){let o=i("field-cell"),a=t[e][r];o.classList.add("field-cell"),a>0&&(o.classList.add(`field-cell--${a}`),o.textContent=a),s.append(o)}this.tbody.append(s)}}},u=(t,e)=>{e.classList.contains(s.start)?(t.start(),e.classList.remove(s.start),e.classList.add(s.restart),e.textContent=d(s.restart)):(e.classList.add(s.start),e.classList.remove(s.restart),e.textContent=d(s.start),t.restart())};const f=new m,w=document.querySelector("button");w.addEventListener("click",()=>{u(f,w)});
//# sourceMappingURL=index.9d21d22e.js.map
